{{- if .Values.taskService.enabled }}
# Service
{{- $serviceContext := dict "root" . "serviceName" "task-service" "serviceConfig" .Values.taskService }}
{{- include "vertex.service" $serviceContext }}
---
# Deployment
{{- $extraEnv := list (dict "name" "HUB_SERVICE_URL" "key" "HUB_SERVICE_URL") }}
{{- $deploymentContext := dict "root" . "serviceName" "task-service" "serviceConfig" .Values.taskService "dbName" "vertex_task" "extraEnv" $extraEnv }}
{{- include "vertex.deployment" $deploymentContext }}
---
# HorizontalPodAutoscaler
{{- $hpaContext := dict "root" . "serviceName" "task-service" "serviceConfig" .Values.taskService }}
{{- include "vertex.hpa" $hpaContext }}
---
# NetworkPolicy
{{- $extraEgress := list (dict "app" "hub-service" "port" 8080) }}
{{- $networkContext := dict "root" . "serviceName" "task-service" "extraEgress" $extraEgress }}
{{- include "vertex.networkpolicy" $networkContext }}
---
# PodDisruptionBudget
{{- $pdbContext := dict "root" . "serviceName" "task-service" }}
{{- include "vertex.pdb" $pdbContext }}
{{- end }}