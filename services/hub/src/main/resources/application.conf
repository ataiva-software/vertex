ktor {
    deployment {
        port = 8080
        port = ${?PORT}
    }
    application {
        modules = [ com.ataiva.eden.hub.ApplicationKt.module ]
    }
}

hub {
    database {
        url = "jdbc:h2:mem:hub;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE"
        url = ${?DATABASE_URL}
        driver = "org.h2.Driver"
        driver = ${?DATABASE_DRIVER}
        user = "sa"
        user = ${?DATABASE_USER}
        password = ""
        password = ${?DATABASE_PASSWORD}
        maxPoolSize = 10
        maxPoolSize = ${?DATABASE_MAX_POOL_SIZE}
    }
    
    security {
        jwtSecret = "hub-service-jwt-secret-key-change-in-production"
        jwtSecret = ${?JWT_SECRET}
        jwtIssuer = "eden-hub-service"
        jwtAudience = "eden-users"
        jwtRealm = "Eden Hub Service"
        encryptionKey = "hub-encryption-key-32-chars-long"
        encryptionKey = ${?ENCRYPTION_KEY}
    }
    
    integrations {
        github {
            baseUrl = "https://api.github.com"
            baseUrl = ${?GITHUB_BASE_URL}
            timeout = 30000
            retryAttempts = 3
        }
        
        slack {
            baseUrl = "https://slack.com/api"
            baseUrl = ${?SLACK_BASE_URL}
            timeout = 30000
            retryAttempts = 3
        }
        
        jira {
            timeout = 30000
            retryAttempts = 3
        }
        
        aws {
            timeout = 30000
            retryAttempts = 3
            defaultRegion = "us-east-1"
            defaultRegion = ${?AWS_DEFAULT_REGION}
        }
    }
    
    webhooks {
        timeout = 30000
        timeout = ${?WEBHOOK_TIMEOUT}
        retryAttempts = 5
        retryAttempts = ${?WEBHOOK_RETRY_ATTEMPTS}
        retryDelayMs = 1000
        retryDelayMs = ${?WEBHOOK_RETRY_DELAY_MS}
        maxRetryDelayMs = 300000
        maxRetryDelayMs = ${?WEBHOOK_MAX_RETRY_DELAY_MS}
        threadPoolSize = 10
        threadPoolSize = ${?WEBHOOK_THREAD_POOL_SIZE}
    }
    
    notifications {
        email {
            enabled = false
            enabled = ${?EMAIL_ENABLED}
            smtpHost = "smtp.gmail.com"
            smtpHost = ${?SMTP_HOST}
            smtpPort = 587
            smtpPort = ${?SMTP_PORT}
            username = ""
            username = ${?SMTP_USERNAME}
            password = ""
            password = ${?SMTP_PASSWORD}
            fromAddress = "noreply@eden.com"
            fromAddress = ${?EMAIL_FROM_ADDRESS}
            fromName = "Eden Hub Service"
            fromName = ${?EMAIL_FROM_NAME}
        }
        
        sms {
            enabled = false
            enabled = ${?SMS_ENABLED}
            provider = "twilio"
            provider = ${?SMS_PROVIDER}
            accountSid = ""
            accountSid = ${?TWILIO_ACCOUNT_SID}
            authToken = ""
            authToken = ${?TWILIO_AUTH_TOKEN}
            fromNumber = ""
            fromNumber = ${?TWILIO_FROM_NUMBER}
        }
        
        push {
            enabled = false
            enabled = ${?PUSH_ENABLED}
            fcmServerKey = ""
            fcmServerKey = ${?FCM_SERVER_KEY}
        }
        
        threadPoolSize = 10
        threadPoolSize = ${?NOTIFICATION_THREAD_POOL_SIZE}
        retryAttempts = 3
        retryAttempts = ${?NOTIFICATION_RETRY_ATTEMPTS}
    }
    
    events {
        enabled = true
        enabled = ${?EVENTS_ENABLED}
        bufferSize = 1000
        bufferSize = ${?EVENTS_BUFFER_SIZE}
        flushIntervalMs = 5000
        flushIntervalMs = ${?EVENTS_FLUSH_INTERVAL_MS}
        threadPoolSize = 5
        threadPoolSize = ${?EVENTS_THREAD_POOL_SIZE}
    }
    
    monitoring {
        enabled = true
        enabled = ${?MONITORING_ENABLED}
        metricsIntervalMs = 60000
        metricsIntervalMs = ${?METRICS_INTERVAL_MS}
        healthCheckIntervalMs = 30000
        healthCheckIntervalMs = ${?HEALTH_CHECK_INTERVAL_MS}
    }
}