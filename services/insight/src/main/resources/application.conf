# Database configuration for Insight Service

database {
  # PostgreSQL connection settings
  driver = "org.postgresql.Driver"
  url = "jdbc:postgresql://localhost:5432/insight_db"
  user = "insight_user"
  password = "insight_password"
  
  # Connection pool settings - optimized for high load
  pool {
    max-size = 50
    min-idle = 10
    idle-timeout = 30000
    max-lifetime = 1800000  # 30 minutes
    connection-timeout = 10000
    validation-timeout = 5000
    leak-detection-threshold = 60000
    register-mbeans = true
  }
  
  # Migration settings
  migration {
    enabled = true
    location = "db/migration"
    baseline-on-migrate = true
  }
}

# Insight Service specific settings
insight {
  # Output path for generated reports
  report-output-path = "./reports"
  
  # Cache settings
  cache {
    # In-memory cache settings
    in-memory {
      enabled = true
      max-size = 5000
      ttl-minutes = 30
    }
    
    # Redis cache settings
    redis {
      enabled = true
      host = "redis"
      port = 6379
      password = ""
      database = 0
      ttl-minutes = 120
      pool-size = 20
      pool-max-idle = 10
      pool-min-idle = 5
    }
    
    # Cache policies for different data types
    policies {
      queries = "redis"         # Store queries in Redis
      reports = "redis"         # Store reports in Redis
      dashboards = "redis"      # Store dashboards in Redis
      metrics = "in-memory"     # Store metrics in in-memory cache
      kpis = "in-memory"        # Store KPIs in in-memory cache
      analytics = "redis"       # Store analytics in Redis
    }
  }
  
  # Metrics collection settings
  metrics {
    collection-interval-seconds = 30
    retention-days = 30
  }
  
  # Analytics engine settings
  analytics-engine {
    query-timeout-seconds = 60
    max-result-rows = 10000
    cache-enabled = true
  }
}